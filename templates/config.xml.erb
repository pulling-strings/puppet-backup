<configuration version="2">
  <% @repos.each_pair do |repo, props| -%>
    <repository id="<%=repo%>" directory="<%=props['directory']%>" ro="<%=props['ro']%>" rescanIntervalS="60" ignorePerms="false">
    <% props['nodes'].each do |id| -%>
      <node id="<%=id%>"></node>
    <% end -%>
    <versioning></versioning>
  </repository>
  <% end -%>

  <% @nodes.each_pair do |id, props|-%>
  <node id="<%=id%>" name="<%=props['name']%>" compression="true">
    <address><%=props['address']%></address>
  </node>
  <% end -%>

  <gui enabled="true" tls="true">
    <address>0.0.0.0:8080</address>
    <user><%=@user%></user>
    <password><%=@password%></password>
    <apikey><%=@token%></apikey>
  </gui>

  <options>
     <listenAddress>0.0.0.0:22000</listenAddress>
     <globalAnnounceServer>announce.syncthing.net:22026</globalAnnounceServer>
     <globalAnnounceEnabled>false</globalAnnounceEnabled>
     <localAnnounceEnabled>true</localAnnounceEnabled>
     <localAnnouncePort>21025</localAnnouncePort>
     <localAnnounceMCAddr>[ff32::5222]:21026</localAnnounceMCAddr>
     <parallelRequests>16</parallelRequests>
     <maxSendKbps>0</maxSendKbps>    
     <reconnectionIntervalS>60</reconnectionIntervalS>
     <startBrowser>true</startBrowser>
     <upnpEnabled>false</upnpEnabled>
     <upnpLeaseMinutes>0</upnpLeaseMinutes>
     <upnpRenewalMinutes>30</upnpRenewalMinutes>
     <urAccepted>-1</urAccepted>     
  </options>

</configuration>
